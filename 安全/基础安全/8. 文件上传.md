一句话木马
```
<?php eval($_POST['v']);?>
```
中国菜刀、Cknife等工具实现对服务器的控制

# 文件上传
## 绕过绕过JS检测
（1）上传一句话木马 eval.php，弹窗提示限制上传； 
（2）修改文件后缀为.jpg打开Burp开启拦截，点击上 传文件，查看Burp中拦截到服务器的请求信息； 
（3）将Burp中拦截到的信息中.jpg格式修改为.php； 
（4）此时即可正常上传eval.php文件；
（5）文件上传成功；
## 绕过MIME类型检测
（1）上传一句话木马 eval.php，提示文件类型不正确，请重新上传！ ; 
（2）浏览器设置代理到BurpSuit，并开启拦截； 
（3）上传eval.php 
（4）在拦截的数据包中将application/octet-stream修改为image/jpeg;
## 过滤不严格被绕过
有一些网站使用了黑名单过滤掉了一些关键的可执行脚本文件后 缀。但黑名单 不全或者被绕过，
比如服务端过滤掉了后缀为.php的 文件，但是没有过掉.php3 等其他可执行的脚本文件后缀，攻击者 就可以上传其他的可执行的脚本文件后缀 到服务器上。 
比如:禁止了php, asp, jsp,但是没有禁止php3, asa, cer, cdx,jspx等等.

常用的一些可执行的文件脚本后缀： ・ php , php2 , php3 , php5 , phtml ・ asp , cer , asa , cdx ・ aspx , ascx , ashx ・ jsp , jspx ・py
## 绕过黑名单检测
黑名单检测：一般有个专门的 blacklist 文件，里面会包 含常见的危险脚本文件扩展名，如：php、asp、aspx；

绕过方式:（1）使用大小写绕过（针对对大小写不 敏感的系统如windows），如：PhP;

（1）上传正常的php文件，无法上传；
（2）将文件后缀.php修改为.Php； 
（3）上传.Php文件，上传成功；

绕过方式:（2）黑白名单绕过（php、php2、 php3、php5、phtml、asp、 aspx、ascx、 ashx、 cer、 asa、 jsp、 jspx 、cdx）。
（1）上传正常的php文件，无法上传； 
（2）将文件后缀.php修改为黑名单中不存在的后缀
（3）文件上传成功；（上传成功了也不一定会执行，需要看服务器是否支持）

绕过方式:（3）特殊文件名绕过（后缀加 . 或者空格） 修改数据包里的文件名改为test. php.或者test. php （有空格） 由于这种命名格式在windows系统里是不允许的。所以在绕过上传之后windows系统 会自动去掉 点和空格。Unix/Linux系统没有这个特性。

（1）上传正常的php文件，无法上传； 
（2）将文件后缀.php修改为.php. 或者.php ； 
（3）文件，上传成功；

绕过方式:（4）0x00截断绕过 文件名后缀就一个%00字节，可以截断某些函数对文件名的判断。在许多语 言函数中，处理 字符串的函数中0x00被认为是终止符。 例: 网站上传函数处理xxx. php%00. jpg时，首先后缀名是合法的jpg格式，可以 上传，在保存文件时 遇到%00字符丢弃后面的jpg,文件后缀最终保存的后缀 名为xxx. php .(简单演示,环境没有黑名单限制) 在可以控制文件路径的情况下，使用超长的文件路径也有可能会导致文件路径截断.(系统都有对文件名 长度有限制).(做了解)
（1）上传正常的php文件，无法上传； 
（2）将文件后缀.php修改为.php.jpg上传,burp抓包16进制模式php后面添加00； 
（3）文件，上传成功；
绕过方式:（5）.htaccess文件攻击 修通过move_uploaded_file函数把自己写的.htaccess文件覆盖掉服务器上的这样就可以解析定义名单了。 .htaccess文件用处： 通过.htaccess文件调用php解释器去解析一个文件名中只要包含 “aa”这个字符串的任意文件， 无论你文件名是什么样子，只要包 含”aa”这个字符串，都可以被以php的方式来解析。

.htaccess文件内容： 
```
<FilesMatch "aa" > 
SetHandler application/x-httpd-php 
</FilesMatch>
```
（1）上传正常的php文件，无法上传； 
（2）将文件修改为文件名带aa的,后缀随便,例:aa123.txt； 
（3）文件，上传成功；

绕过方式:（6）解析绕过

1）Apache解析漏洞 一个文件名为test. php. aaa. bbb. ccc的文件，Apache会从ccc的位置往 php的位置开始尝试解析, 如果ccc不属于Apache能解析的后缀名，那么 Apache就会尝试去解析bbb,这样一直往前尝试，直到遇到 一个能解析的扩展名为止。

存在漏洞的版本:apache 2.0-2.2 有可能存在
2）IIS解析漏洞 #1 IIS6.0 @1： 新建一文件名字为：任意文件名.asp;任意文件名.jpg 此文件会当成脚本运行 （1.asa;1.jpg,2.cdx;2.txt） @2: 新建一个文件夹，名字为任意文件名.asp ; 那么在这个文件夹里的内容全部会被当场脚本取运行。 @3:服务器配置错误(put 协议)

3）Nginx解析漏洞 #2 对低版本的Nginx可以在任意文件名后面添加%00.php进行解 析攻击。 • Nginx 0. 5. * Nginx 0. 6. * •Nginx 0. 7 <= 0. 7. 65 Nginx 0. 8 <= 0. 8. 37 正常路径：uploads/1.jpg 黑客思路：uploads/1.jpg%00.php 当做正常脚本执行 #3 • Nginx 0.8. 41 〜1.4. 3 ; 1. 5 <= 1. 5. 7： •在linux系统里，以上Nginx容器的版本下 正常路径：uploads/1.jpg 黑客思路：uploads/1.jpg%20%00.php 当做正常脚本执行

绕过方式:其他方式

某些情况下管理员错误的服务器配置会导致.html ; .xml等静态页面 后缀的文件也可被执行。 多文件上传时，有时服务器只对第一个上传的文件进行了检查，这 时通过上传多个文件并将 恶意文件掺杂进其中也可绕过服务器的过 滤。
